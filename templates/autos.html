<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo de Autos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Reset */
* { box-sizing: border-box; margin:0; padding:0; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #E6EBEF; /* Blanco perlado */
    color: #1B2841; /* Azul profundo */
    padding: 20px;
    overflow-x: hidden;
}

/* Encabezado principal */
h1 {
    text-align: center;
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 30px;
    background: linear-gradient(90deg, #0A0A0A, #43484D);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* Búsqueda */
#search {
    display: block;
    margin: 0 auto 30px auto;
    padding: 12px 20px;
    width: 350px;
    border-radius: 25px;
    border: 2px solid #1B2841;
    font-size: 16px;
    outline: none;
    transition: all 0.3s ease;
}
#search:focus {
    border-color: #0A0A0A;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

/* Botones generales */
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 40px;
}
.action-buttons a {
    padding: 12px 22px;
    background: linear-gradient(135deg, #0A0A0A, #43484D);
    color: #E6EBEF;
    font-weight: bold;
    border-radius: 20px;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s, box-shadow 0.3s, background 0.3s;
    position: relative;
}
.action-buttons a:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    background: linear-gradient(135deg, #43484D, #0A0A0A);
}
#cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #007bff; /* Azul metálico */
    color: #fff;
    border-radius: 50%;
    padding: 4px 8px;
    font-size: 12px;
}

/* Contenedor de autos */
.autos-container {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    justify-content: center;
}

/* Tarjeta de auto */
.auto-card {
    background: linear-gradient(145deg, #ffffff, #A9C2DA); /* Blanco perlado + azul tenue */
    border-radius: 20px;
    width: 280px;
    overflow: hidden;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1), inset 0 -2px 8px rgba(0,0,0,0.05);
    transition: transform 0.4s, box-shadow 0.4s, opacity 0.8s;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    opacity: 0;
    transform: translateY(30px);
}
.auto-card.visible {
    opacity: 1;
    transform: translateY(0);
}
.auto-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 25px 50px rgba(0,0,0,0.2), inset 0 -2px 8px rgba(0,0,0,0.05);
}
.auto-card img {
    width: 100%;
    height: 170px;
    object-fit: cover;
    transition: transform 0.4s;
}
.auto-card img:hover { transform: scale(1.05); }
.auto-card-content { padding: 20px; flex: 1; }
.auto-card-content strong {
    display: block;
    font-size: 1.25rem;
    margin-bottom: 10px;
    color: #0A0A0A; /* Negro brillante */
}
.auto-info { font-size: 14px; line-height: 1.6; color: #43484D; /* Gris acero */ }
.auto-info span.price { display: block; font-size: 1.1rem; font-weight: 700; color: #007bff; margin-top: 5px; }

/* Botón añadir carrito */
.add-cart-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(90deg, #1B2841, #43484D); /* Azul profundo + gris */
    border: none;
    color: #E6EBEF;
    font-weight: bold;
    border-radius: 12px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.3s, background 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}
.add-cart-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 25px rgba(0,0,0,0.25);
    background: linear-gradient(90deg, #43484D, #1B2841);
}

/* Highlight en búsqueda */
.highlight {
    background: #007bff;
    color: #fff;
    border-radius: 3px;
    padding: 0 2px;
}

/* Modal */
.modal {
    display: none; 
    position: fixed;
    z-index: 999;
    left:0; top:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: #fff;
    padding: 25px;
    border-radius: 20px;
    width: 90%;
    max-width: 550px;
    position: relative;
    text-align: left;
}
.modal-content img { width: 100%; border-radius: 12px; margin-bottom: 15px; }
.close-modal {
    position: absolute;
    top: 10px; right: 15px;
    font-size: 1.5rem;
    color: #43484D;
    cursor: pointer;
}

/* Responsive */
@media (max-width: 768px) { .auto-card { width: 90%; } }
</style>
</head>
<body>

<h1>Autos Disponibles</h1>

<div class="action-buttons">
    <a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Inicio</a>
    <a href="{{ url_for('carrito') }}">
    <i class="fas fa-shopping-cart"></i> Carrito 
    <span id="cart-count">0</span>
</a>

</div>

<input type="text" id="search" placeholder="Buscar marca, modelo, motor, color o año...">

{% for categoria, autos_lista in categorias.items() %}
<h2>{{ categoria }}</h2>
{% if autos_lista %}
<div class="autos-container">
    {% for auto in autos_lista %}
    <div class="auto-card" 

        data-id="{{ auto.id }}"
        data-marca="{{ auto.marca | lower }}" 
        data-modelo="{{ auto.modelo | lower }}"
        data-color="{{ auto.color | lower }}"
        data-motor="{{ auto.motor | lower }}"
        data-traccion="{{ auto.traccion | lower }}"
        data-año="{{ auto.año | string }}">
        <img src="{{ url_for('static', filename='images/' ~ auto.imagen) }}" alt="{{ auto.marca }} {{ auto.modelo }}">

        <div class="auto-card-content">
            <strong>{{ auto.marca }} {{ auto.modelo }}</strong>
            <div class="auto-info">
                Año: {{ auto.año }}<br>
                Precio: <span class="price">${{ "{:,.2f}".format(auto.precio) }}</span><br>
                {% if categoria != 'Nuevo' %}Kilometraje: {{ auto.kilometraje }} km<br>{% endif %}
                Motor: {{ auto.motor }}<br>
                Tracción: {{ auto.traccion }}<br>
                Color: {{ auto.color }}<br>
            </div>
            <button class="add-cart-btn" onclick="agregarAlCarrito(this)">
                <i class="fas fa-cart-plus"></i> Añadir al carrito
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No hay autos en esta categoría.</p>
{% endif %}
{% endfor %}

<!-- Modal -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="cerrarModal()">&times;</span>
        <img id="modal-img" src="" alt="">
        <h3 id="modal-title"></h3>
        <p id="modal-info"></p>
    </div>
</div>

<script>
// Animación de tarjetas al cargar
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.auto-card').forEach((card,i) => {
        setTimeout(()=>{card.classList.add('visible');}, i*100);
    });
});

// Búsqueda avanzada con resaltado
document.getElementById('search').addEventListener('input', function() {
    let term = this.value.toLowerCase();

    document.querySelectorAll('.auto-card').forEach(card => {
        let marca = card.dataset.marca;
        let modelo = card.dataset.modelo;
        let color = card.dataset.color;
        let motor = card.dataset.motor;
        let año = card.dataset.año;

        let match = [marca, modelo, color, motor, año].some(v => v.includes(term));
        card.style.display = match ? 'flex' : 'none';

        // Restaurar contenido original
        let strongEl = card.querySelector('strong');
        let infoEl = card.querySelector('.auto-info');
        strongEl.textContent = `${capitalize(marca)} ${capitalize(modelo)}`;
        infoEl.innerHTML = `
            Año: ${año}<br>
            Precio: <span class="price">${infoEl.querySelector('.price') ? infoEl.querySelector('.price').textContent : ''}</span><br>
            Motor: ${motor}<br>
            Tracción: ${card.dataset.traccion}<br>
            Color: ${color}<br>
        `;

        if(term) {
            highlightText(strongEl, term);
            highlightText(infoEl, term);
        }
    });
});

// Funciones de búsqueda
function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1);}
function highlightText(el, term){
    const regex = new RegExp(`(${term})`, 'gi');
    el.innerHTML = el.textContent.replace(regex, '<span class="highlight">$1</span>');
}

// Modal
function abrirModal(marca, modelo, año, precio, motor, traccion, color, imagen){
    document.getElementById('modal-img').src = imagen;
    document.getElementById('modal-title').textContent = marca + ' ' + modelo;
    document.getElementById('modal-info').innerHTML = `
        Año: ${año}<br>
        Precio: $${parseFloat(precio).toLocaleString()}<br>
        Motor: ${motor}<br>
        Tracción: ${traccion}<br>
        Color: ${color}
    `;
    document.getElementById('modal').style.display = 'flex';
}
function cerrarModal(){document.getElementById('modal').style.display='none';}
window.onclick = e => {if(e.target==document.getElementById('modal')) cerrarModal();}

// Carrito animado
let carritoCount = 0;
function agregarAlCarrito(btn){
    const card = btn.closest('.auto-card');
    const id = card.dataset.id;

    fetch("/agregar_carrito", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({id: parseInt(id)})
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('cart-count').textContent = data.total;
    });

    // ANIMACIÓN DEL AUTO VOLANDO
    const img = card.querySelector('img');
    const flyImg = img.cloneNode(true);
    const rect = img.getBoundingClientRect();
    flyImg.style.position='fixed';
    flyImg.style.left = rect.left+'px';
    flyImg.style.top = rect.top+'px';
    flyImg.style.width = rect.width+'px';
    flyImg.style.height = rect.height+'px';
    flyImg.style.transition='all 0.8s ease-in-out';
    flyImg.style.zIndex=1000;
    document.body.appendChild(flyImg);

    const cartIcon = document.querySelector('.action-buttons a:nth-child(2)');
    const cartRect = cartIcon.getBoundingClientRect();

    setTimeout(()=> {
        flyImg.style.left = cartRect.left+'px';
        flyImg.style.top = cartRect.top+'px';
        flyImg.style.width='20px';
        flyImg.style.height='20px';
        flyImg.style.opacity=0.5;
    },50);

    setTimeout(()=>{document.body.removeChild(flyImg);},850);
}

</script>
</body>
</html>
